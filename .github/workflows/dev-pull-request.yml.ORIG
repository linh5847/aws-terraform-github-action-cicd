######################################################
### USER RESPONSIBLE TO CHANGE PATH/DIRECTORY NAME ###
### CURRENTLY dev, stage, prod folders             ###
###                                                ###
### Looks for keyword path: and change the name to ###
### one of above ie dev                            ###
######################################################

#checkov:skip:CKV2_GHA_1:Comment
name: "Push to Feature Branch"
permissions: read-all
on:
  workflow_dispatch:
  push:
    branches:
      - '*'
      - '!develop'
      - '!stage'
      - '!main'
    
  pull_request:
    branches:
      - develop

  # pull_request_review:
  #   types: [submitted]

jobs:
  validate-build:
    permissions: #Permission is required if enabling TFSEC == true
      actions: read
      contents: read
      security-events: write
    uses: ./.github/workflows/az_tf_plan.yml
    with:
      path: dev # Path to terraform root module (Required)
      enable_TFSEC: true ## (Optional)  Enable TFSEC IaC scans (Private repo requires GitHub enterprise)
    secrets:
      aws_access_key_id: ${{ secrets.DEV_AWS_ACCESS_KEY_ID }} ## AWS_ACCESS_KEY_ID
      aws_secret_access_key: ${{ secrets.DEV_AWS_SECRET_ACCESS_KEY }} ## AWS_SECRET_ACCESS_KEY
      aws_default_region: ${{ secrets.DEV_AWS_DEFAULT_REGION }} ## AWS_DEFAULT_REGION
      terraform_version: ${{ secrets.TERRAFORM_VERSION }}